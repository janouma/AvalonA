!function(){var t,i,e=function(t,i){return function(){return t.apply(i,arguments)}};t=function(){function t(t){var i,e,o,s;if(this.area=t,!this.area)throw new Error("area argument is missing");this.position=this.area.position||"auto","object"==typeof this.position&&(null==(o=(i=this.position).x)&&(i.x="auto"),null==(s=(e=this.position).y)&&(e.y="auto"),"auto"===this.position.x&&"auto"===this.position.y&&(this.position="auto")),this.attachment=this.area.attachment||"fixed",this.assertValid(),this.processActiveArea()}var i,e;return i=/^\d+(%|px)?$/gi,e=function(t){var e;return i.lastIndex=0,e=i.test(t),i.lastIndex=0,e},t.prototype.assertValid=function(){var t,i;if(t=["The following validation errors occured:"],"object"!=typeof this.position?"auto"!==this.position&&t.push("area.position is not valid ("+this.position+")"):("auto"===this.position.x||e(this.position.x)||t.push("area.position.x is not valid ("+this.position.x+"})"),"auto"===this.position.y||e(this.position.y)||t.push("area.position.y is not valid ("+this.position.y+"})")),"fixed"!==(i=this.attachment)&&"scroll"!==i&&t.push("area.attachment is not valid ("+this.attachment+")"),e(this.area.width)||t.push("area.width is not valid ("+this.area.width+")"),e(this.area.height)||t.push("area.height is not valid ("+this.area.height+")"),t.length>1)throw new Error(t.join("\n"))},t.prototype.processActiveArea=function(){return this.width=parseInt(this.area.width,10),this.widthIsFluid="%"===i.exec(this.area.width)[1],i.lastIndex=0,this.height=parseInt(this.area.height,10),this.heightIsFluid="%"===i.exec(this.area.height)[1],i.lastIndex=0,"object"==typeof this.position&&("auto"!==this.position.x&&(this.x=parseInt(this.position.x,10)),"auto"!==this.position.y)?this.y=parseInt(this.position.y,10):void 0},t.prototype.init=function(t){var i,e,o,s,n,r,a,h=this;if(this.frame=t,!this.frame)throw new Error("frame argument cannot be null");return this.xBase=(r=this.getXBaseComputation())(),this.yBase=(a=this.getYBaseComputation())(),this.xMaxComputation=this.widthIsFluid?function(){return this.xMin+this.width/100*this.frame.width()}:function(){return this.xMin+this.width},this.yMaxComputation=this.heightIsFluid?function(){return this.yMin+this.height/100*this.frame.height()}:function(){return this.yMin+this.height},"fixed"===this.attachment?(this.xPadding=this.frame.prop("scrollLeft"),this.yPadding=this.frame.prop("scrollTop"),this.debug===!0?(console.log("Listen to scroll event"),s=this,o=function(){return console.log("Scroll : @xPadding = "+s.xPadding+", @yPadding = "+s.yPadding)}):o=function(){},n=0,$(window).scroll(function(){return++n%5>0?void 0:(h.xPadding=$(window).prop("pageXOffset"),h.yPadding=$(window).prop("pageYOffset"),h.refreshBounds(),o())}),i=0,this.frame.scroll(function(){return++i%5>0?void 0:(h.xPadding=h.frame.prop("scrollLeft"),h.yPadding=h.frame.prop("scrollTop"),h.refreshBounds(),o())})):this.xPadding=this.yPadding=0,this.debug===!0?(s=this,e=function(){return console.log("Resize : @frame.width() = "+s.frame.width()+", @frame.height() = "+s.frame.height())}):e=function(){},$(window).resize(function(){return h.xBase=r(),h.yBase=a(),h.refreshBounds(),e()}),this.refreshBounds()},t.prototype.refreshBounds=function(){return this.xMin=this.xBase+this.xPadding,this.xMax=this.xMaxComputation(),this.yMin=this.yBase+this.yPadding,this.yMax=this.yMaxComputation()},t.prototype.bounds=function(){return{xMin:this.xMin,xMax:this.xMax,yMin:this.yMin,yMax:this.yMax}},t.prototype.getXBaseComputation=function(){var t,e=this;return this.position.x&&"auto"!==this.position.x?(t="%"===i.exec(this.position.x)[1]?function(){return e.x/100*e.frame.width()}:function(){return e.x},i.lastIndex=0):t=this.widthIsFluid?function(){return(50-e.width/2)/100*e.frame.width()}:function(){return e.frame.width()/2-e.width/2},t},t.prototype.getYBaseComputation=function(){var t,e=this;return this.position.y&&"auto"!==this.position.y?(t="%"===i.exec(this.position.y)[1]?function(){return e.y/100*e.frame.height()}:function(){return e.y},i.lastIndex=0):t=this.heightIsFluid?function(){return(50-e.height/2)/100*e.frame.height()}:function(){return e.frame.height()/2-e.height/2},t},t.prototype.mouseover=function(t){var i,e;return this.xMin<=(i=t.pageX)&&i<=this.xMax&&this.yMin<=(e=t.pageY)&&e<=this.yMax},t}(),i=function(){function i(t,i){this.id=t,null==i&&(i={}),this.zRefreshChild=e(this.zRefreshChild,this),this.mousemove=e(this.mousemove,this),this.mouseout=e(this.mouseout,this),this.debug=i.debug,s(),this.debug===!0&&console.log("transformStyleIsSupported: "+r),r?this.init(i):this.refresh=this.setZOf=this.zRefreshChild=this.zRefresh=this.untrackMouseMovements=this.trackMouseMovements=this.setPerspective=function(){}}var o,s,n,r,a;return a=.75,n=function(t){return t},r=null,s=function(){var t,i,e,o,s,n,a,h,u;return null===r&&(o="avalona-detection-element",t=$("body").prepend("<b id='"+o+"' style='position:absolute; top:0; left:0;'></b>"),e=$("#"+o),null!=(n=e[0].style)&&(n.webkitTransformStyle="preserve-3d"),null!=(a=e[0].style)&&(a.MozTransformStyle="preserve-3d"),null!=(h=e[0].style)&&(h.msTransformStyle="preserve-3d"),null!=(u=e[0].style)&&(u.transformStyle="preserve-3d"),i=getComputedStyle(e[0],null),s=i.getPropertyValue("-webkit-transform-style")||i.getPropertyValue("-moz-transform-style")||i.getPropertyValue("-ms-transform-style")||i.getPropertyValue("transform-style"),r="preserve-3d"===s,e.remove()),r},o=function(t){return""+t.prop("tagName")+"("+(t.attr("id")||t.attr("class")||t.attr("href"))+")"},i.prototype.find3dFrames=function(){if(this.frame=$("#"+this.id),this.transformedLayer=$("."+this.cssClass,this.frame).eq(0),this.debug===!0&&(console.log("@deepnessAttribute: "+this.deepnessAttribute),console.log("@cssClass: "+this.cssClass)),!this.frame.size())throw new Error("Cannot find 3d frame '#"+this.id+"' in dom");if(!this.transformedLayer.size())throw new Error("Cannot find 3d inner frame '#"+this.id+" ."+this.cssClass+"' in dom")},i.prototype.setPerspective=function(){return TweenLite.set(this.transformedLayer[0],{css:{transformPerspective:1e3}})},i.prototype.trackMouseMovements=function(){var t;return this.debug===!0?($("body").append("<div id='avalona-active-area' style='background-color:hotpink;opacity:0.75;pointer-events:none;position:absolute;visibility:hidden;z-index:10000;'>AvalonA Active Area</div>"),t=$("#avalona-active-area"),this.debugMouseMove=function(){var i;return console.log("rotationX: "+this.rotationX+", rotationY: "+this.rotationY),i=this.activeArea.bounds(),t.css({visibility:"visible",left:""+i.xMin+"px",top:""+i.yMin+"px",width:""+(i.xMax-i.xMin)+"px",height:""+(i.yMax-i.yMin)+"px"})}):this.debugMouseMove=function(){},this.activeArea?this.activeArea.init(this.frame):this.frame.on("mouseout","#"+this.id,this.mouseout),this.frame.mousemove(this.mousemove)},i.prototype.mouseout=function(){return this.cancelRotation()},i.prototype.mouseMoveCount=0,i.prototype.mousemove=function(t){return++this.mouseMoveCount%5>0?void 0:!this.activeArea||this.activeArea.mouseover(t)?(this.onrotation(),this.rotationY=(t.pageX-$(window).prop("innerWidth")/2)/25,this.rotationX=-1*(t.pageY-$(window).prop("innerHeight")/2)/15,this.debugMouseMove(),TweenLite.to(this.transformedLayer[0],.1,{css:{rotationX:this.fy(this.rotationX),rotationY:this.fx(this.rotationY)}})):this.rotationX||this.rotationY?this.cancelRotation():void 0},i.prototype.onrotation=function(){var t,i=this;return clearTimeout(this.timeoutId),this.rotating||(null!=(t=this.animation)&&t.pause(),"function"==typeof this.onstartrotation&&this.onstartrotation(),this.rotating=!0),this.onendrotation||this.animation?this.timeoutId=setTimeout(function(){var t;return i.rotating=!1,"function"==typeof i.onendrotation&&i.onendrotation(),null!=(t=i.animation)?t.play():void 0},1e3):void 0},i.prototype.cancelRotation=function(){return this.rotationX=this.rotationY=0,TweenLite.to(this.transformedLayer[0],1,{css:{rotationX:0,rotationY:0}})},i.prototype.untrackMouseMovements=function(){var t,i;return null!=(t=this.frame)&&t.off("mousemove",this.mousemove),null!=(i=this.frame)?i.off("mouseout",this.mouseout):void 0},i.prototype.zRefresh=function(t){var i,e,s;return null==t&&(t=null),e=this,null==t&&(t=this.transformedLayer),s="string"==typeof t?$(s,this.transformedLayer):$(t),this.debug===!0&&console.log("target: "+o(s)),this.setZOf(s),i=s.children().eq(0),this.debug===!0&&console.log("zRefresh firstChild: "+o(i)),this.zRefreshChild(i).siblings().each(function(){return e.zRefreshChild($(this))})},i.prototype.zRefreshChild=function(t){if(!t)throw new Error("zRefreshChild child argument cannot be null");return $("["+this.deepnessAttribute+"]",t).length?(this.debug===!0&&console.log("zRefresh child "+o(t)+" has children"),this.zRefresh(t)):t.attr(this.deepnessAttribute)&&(this.debug===!0&&console.log("zRefresh child "+o(t)+" has '"+this.deepnessAttribute+"'"),this.setZOf(t)),t},i.prototype.setZOf=function(t){var i;if(!t)throw new Error("setZOf target argument cannot be null");return TweenLite.set(t[0],{css:{transformStyle:"preserve-3d",overflow:"visible"}}),i=t.attr(this.deepnessAttribute),i?TweenLite.to(t[0],a,{css:{z:i}}):void 0},i.prototype.refresh=function(){var t,i;return null!=(t=this.animation)&&t.pause(),this.untrackMouseMovements(),this.find3dFrames(),this.setPerspective(),this.zRefresh(),this.trackMouseMovements(),null!=(i=this.animation)?i.play(this.transformedLayer[0]):void 0},i.prototype.start=function(){return this.refresh()},i.prototype.init=function(i){var e,o,s;return this.deepnessAttribute=i.zAttr||"data-avalonA-deepness",this.cssClass=i["class"]||"avalona-inner-frame",this.fx="function"==typeof i.fx?i.fx:n,this.fy="function"==typeof i.fy?i.fy:n,i.activeArea&&(this.activeArea=new t(i.activeArea)),null!=(e=this.activeArea)&&(e.debug=this.debug),this.onstartrotation=null!=(o=i.on)?o.startrotation:void 0,this.onendrotation=null!=(s=i.on)?s.endrotation:void 0,this.animation=i.animation,this.animation?this.assertAnimatorValid():void 0},i.prototype.assertAnimatorValid=function(){if(!this.animation.play||"function"!=typeof this.animation.play)throw new Error("animation.play must be a function");if(!this.animation.pause||"function"!=typeof this.animation.pause)throw new Error("animation.pause must be a function")},i}(),window.AvalonA=function(t,e){return null==e&&(e=!1),new i(t,e)}}.call(this);
;