(function(){var t,e,i,r,o,n,s,a=[].indexOf||function(t){for(var e=0,i=this.length;i>e;e++)if(e in this&&this[e]===t)return e;return-1},h=function(t,e){return function(){return t.apply(e,arguments)}};e={getTransformStyle:function(t){return t.getPropertyValue("-webkit-transform-style")||t.getPropertyValue("-moz-transform-style")||t.getPropertyValue("-ms-transform-style")||t.getPropertyValue("transform-style")},getTransform:function(t){return t.getPropertyValue("-webkit-transform")||t.getPropertyValue("-moz-transform")||t.getPropertyValue("-o-transform")||t.getPropertyValue("-ms-transform")||t.getPropertyValue("transform")},getDebugName:function(t){return t.tagName+"("+(t.id||t.getAttribute("class")||t.getAttribute("href"))+")"}},t=function(){function t(t){var e,i;if(this.area=t,!this.area)throw new Error("area argument is missing");this.position=this.area.position||"auto","object"==typeof this.position&&(null==(e=this.position).x&&(e.x="auto"),null==(i=this.position).y&&(i.y="auto"),"auto"===this.position.x&&"auto"===this.position.y&&(this.position="auto")),this.attachment=this.area.attachment||"fixed",this.assertValid(),this.processActiveArea()}var e,i;return e=/^\d+(%|px)?$/gi,i=function(t){var i;return e.lastIndex=0,i=e.test(t),e.lastIndex=0,i},t.prototype.assertValid=function(){var t,e;if(t=["The following validation errors occured:"],"object"!=typeof this.position?"auto"!==this.position&&t.push("area.position is not valid ("+this.position+")"):("auto"===this.position.x||i(this.position.x)||t.push("area.position.x is not valid ("+this.position.x+"})"),"auto"===this.position.y||i(this.position.y)||t.push("area.position.y is not valid ("+this.position.y+"})")),"fixed"!==(e=this.attachment)&&"scroll"!==e&&t.push("area.attachment is not valid ("+this.attachment+")"),i(this.area.width)||t.push("area.width is not valid ("+this.area.width+")"),i(this.area.height)||t.push("area.height is not valid ("+this.area.height+")"),t.length>1)throw new Error(t.join("\n"))},t.prototype.processActiveArea=function(){return this.width=parseInt(this.area.width,10),this.widthIsFluid="%"===e.exec(this.area.width)[1],e.lastIndex=0,this.height=parseInt(this.area.height,10),this.heightIsFluid="%"===e.exec(this.area.height)[1],e.lastIndex=0,"object"==typeof this.position&&("auto"!==this.position.x&&(this.x=parseInt(this.position.x,10)),"auto"!==this.position.y)?this.y=parseInt(this.position.y,10):void 0},t.prototype.init=function(t){var e,i,r,o,n,s,a;if(this.frame=t,!this.frame)throw new Error("frame argument cannot be null");return this.xBase=(s=this.getXBaseComputation())(),this.yBase=(a=this.getYBaseComputation())(),this.widthIsFluid?this.xMaxComputation=function(){return this.xMin+this.width/100*parseInt(getComputedStyle(this.frame).width,10)}:this.xMaxComputation=function(){return this.xMin+this.width},this.heightIsFluid?this.yMaxComputation=function(){return this.yMin+this.height/100*parseInt(getComputedStyle(this.frame).height,10)}:this.yMaxComputation=function(){return this.yMin+this.height},"fixed"===this.attachment?(this.xPadding=this.frame.scrollLeft,this.yPadding=this.frame.scrollTop,this.debug===!0?(console.log("Listen to scroll event"),o=this,r=function(){return console.log("Scroll : @xPadding = "+o.xPadding+", @yPadding = "+o.yPadding)}):r=function(){},n=0,window.addEventListener("scroll",function(t){return function(){return++n%5>0?void 0:(t.xPadding=window.pageXOffset,t.yPadding=window.pageYOffset,t.refreshBounds(),r())}}(this),!1),e=0,this.frame.addEventListener("scroll",function(t){return function(){return++e%5>0?void 0:(t.xPadding=t.frame.scrollLeft,t.yPadding=t.frame.scrollTop,t.refreshBounds(),r())}}(this),!1)):this.xPadding=this.yPadding=0,this.debug===!0?(o=this,i=function(){return console.log("Resize : @frame.style.width = "+getComputedStyle(o.frame).width+", @frame.style.height = "+getComputedStyle(o.frame).height)}):i=function(){},window.addEventListener("resize",function(t){return function(){return t.xBase=s(),t.yBase=a(),t.refreshBounds(),i()}}(this),!1),this.refreshBounds()},t.prototype.refreshBounds=function(){return this.xMin=this.xBase+this.xPadding,this.xMax=this.xMaxComputation(),this.yMin=this.yBase+this.yPadding,this.yMax=this.yMaxComputation()},t.prototype.bounds=function(){return{xMin:this.xMin,xMax:this.xMax,yMin:this.yMin,yMax:this.yMax}},t.prototype.getXBaseComputation=function(){var t,i;return t=parseInt(getComputedStyle(this.frame).width,10),this.position.x&&"auto"!==this.position.x?(i="%"===e.exec(this.position.x)[1]?function(e){return function(){return e.x/100*t}}(this):function(t){return function(){return t.x}}(this),e.lastIndex=0):i=this.widthIsFluid?function(e){return function(){return(50-e.width/2)/100*t}}(this):function(e){return function(){return t/2-e.width/2}}(this),i},t.prototype.getYBaseComputation=function(){var t,i;return t=parseInt(getComputedStyle(this.frame).height,10),this.position.y&&"auto"!==this.position.y?(i="%"===e.exec(this.position.y)[1]?function(e){return function(){return e.y/100*t}}(this):function(t){return function(){return t.y}}(this),e.lastIndex=0):i=this.heightIsFluid?function(e){return function(){return(50-e.height/2)/100*t}}(this):function(e){return function(){return t/2-e.height/2}}(this),i},t.prototype.mouseover=function(t){var e,i;return this.xMin<=(e=t.pageX)&&e<=this.xMax&&this.yMin<=(i=t.pageY)&&i<=this.yMax},t}(),r=function(){function t(){}return t.prototype._Ø=Object.create(null),t.prototype.register=function(t){return"function"==typeof t?(null!=this._listeners?this._listeners:this._listeners=[]).push(t):void 0},t.prototype.unregister=function(t){var e;return!this._listeners||(e=this._listeners.indexOf(t),0>e)?void 0:this._listeners.splice(e,1)},t.prototype.clear=function(){return this._listener=void 0},t.prototype.send=function(t,e){var i,r,o,n,s;if(this._listeners){for(n=this._listeners,s=[],i=0,r=n.length;r>i;i++)o=n[i],s.push(o.call(this._Ø,t,e));return s}},t}(),i=function(){function t(t,e){var i;this.node=t,this._transformAttribute=e,this.node.id&&(this.id=this.node.id),this.node.className&&(this.classes=function(){var t,e,r,o;for(r=this.node.className.split(/\s+/g),o=[],t=0,e=r.length;e>t;t++)i=r[t],o.push(i);return o}.call(this)),this.on={refresh:new r}}var e,i,o,n,s;for(t.properties=["x","y","z","rx","ry","rz","ox","oy","oz"],s=t.properties,e=function(e){var i;return i=new RegExp("\\b"+e+"\\s*:\\s*(-?\\d+(\\.\\d+)?)\\b"),Object.defineProperty(t.prototype,e,{get:function(){var t,r,o;return r=this.node.getAttribute(this._transformAttribute),o=parseFloat(null!=(t=i.exec(r))?t[1].trim():void 0,10),isNaN(o)?"o"!==e[0]?0:.5:o},set:function(t){var r,o,n;if(o=parseFloat(t,10),isNaN(o))throw"[Layer] - set "+e+" - value ("+t+") is not valid";return n=this.node.getAttribute(this._transformAttribute).trim(),i.test(n)?r=n.replace(i,e+":"+o):(r=e+":"+o,n&&(r=n+"; "+r)),this.node.setAttribute(this._transformAttribute,r)}})},i=0,o=s.length;o>i;i++)n=s[i],e(n);return t.prototype.refresh=function(){return this.on.refresh.send(this)},t.prototype.transform=function(e){var i,r;i=[];for(n in e)r=e[n],a.call(t.properties,n)>=0&&i.push(this[n]=r);return i},t}(),o=function(){function t(t){if(this._onTweenComplete=h(this._onTweenComplete,this),this._from=t.from,this._isRoot=t.isRoot,this._transformAttribute=t.transformAttribute,this._debug=t.debug||!1,!this._from)throw"[Transformer] - constructor - from argument must be defined";if(!this._transformAttribute)throw"[Transformer] - constructor - transformAttribute argument must be defined";if(null==this._isRoot)throw"[Transformer] - constructor - isRoot argument must be defined";this.on={complete:new r}}return t.CSS_BACKUP_ATTRIBUTE="data-css-backup",t.TRANSITION_DURATION=.75,t.prototype._static=t,t.prototype.applyTransform=function(){return this._calcTransformsCount(),this._applyTransform(this._from,this._isRoot)},t.prototype._calcTransformsCount=function(){var t,e;return e=this._transformAttribute,t=this._from,this._transformsCount=t.querySelectorAll("["+e+"]").length,t.getAttribute(e)?this._transformsCount++:void 0},t.prototype._applyTransform=function(r,o){var n,s,a,h,u,f,l,d,p,m,c,y,g,v,b,x,T,w;for(null==o&&(o=!1),p=this._layers={all:[]},w=this._transformAttribute,this._applyOn(r),this._debug===!0&&(h=r.firstElementChild,h&&console.log("[Transformer] - refreshTransform - firstChild: "+e.getDebugName(h))),g=r.children,u=0,m=g.length;m>u;u++)n=g[u],T=this._refreshChildTransform(n),T&&(v=p.all).push.apply(v,T);if(!o&&r.getAttribute(w)&&(p.root=new i(r,w),p.all.push(p.root)),o)for(b=p.all,f=0,c=b.length;c>f;f++)if(d=b[f],d.id&&(p["#"+d.id]=d),d.registered||(d.registered=!0,d.on.refresh.register(function(e){return function(i){return new t({from:i.node,isRoot:!1,transformAttribute:w,debug:e._debug}).applyTransform()}}(this))),d.classes)for(x=d.classes,l=0,y=x.length;y>l;l++)a=x[l],s="."+a,null==p[s]&&(p[s]=[]),p[s].push(d);return p},t.prototype._refreshChildTransform=function(t){var r;if(!t)throw"[Transformer] - _refreshChildTransform - child argument cannot be null";return r=this._transformAttribute,t.querySelectorAll("["+r+"]").length?(this._debug===!0&&console.log("[Transformer] - _refreshChildTransform - child "+e.getDebugName(t)+" has children"),this._applyTransform(t).all):(t.getAttribute(r)&&(this._debug===!0&&console.log("[Transformer] - _refreshChildTransform - child "+e.getDebugName(t)+" has '"+r+"'"),this._applyOn(t)),t.getAttribute(r)?[new i(t,r)]:void 0)},t.prototype._applyOn=function(t){var e,i,r,o,n,s,a,h,u,f,l,d,p,m,c,y,g,v,b,x,T,w,A,_,C;if(!t)throw"[Transformer] - _applyOn - target argument cannot be null";if(b=this._transformAttribute,this._backup(t),TweenLite.set(t,{css:{transformStyle:"preserve-3d",overflow:"visible"}}),e=t.getAttribute(b)){for(T={},d=e.split(";"),r=0,n=d.length;n>r;r++)v=d[r],v.trim()&&(p=v.split(":"),l=p[0],w=p[1],T[l.trim()]=parseFloat(w.trim(),10));if(A=T.x,_=T.y,C=T.z,c=T.rx,y=T.ry,g=T.rz,h=T.ox,u=T.oy,f=T.oz,A||_||C||c||y||g||h||u||f){for(i={},A&&(i.x=A),_&&(i.y=_),C&&(i.z=C),c&&(i.rotationX=c),y&&(i.rotationY=y),g&&(i.rotationZ=g),x=[],m=[f,u,h],o=0,s=m.length;s>o;o++)a=m[o],(null!=a||x.length>0)&&x.unshift(100*(null!=a?a:.5)+"%");return x.length>0&&(i.transformOrigin=x.join(" ")),TweenLite.to(t,this._static.TRANSITION_DURATION,{css:i}).eventCallback("onComplete",this._onTweenComplete)}}},t.prototype._backup=function(i){var r,o,n;return i.getAttribute(this._static.CSS_BACKUP_ATTRIBUTE)?void 0:(o=getComputedStyle(i),r={transformStyle:e.getTransformStyle(o)||"flat",overflow:o.overflow||"inherit"},n=e.getTransform(o),n&&(r.transform=n),i.setAttribute(t.CSS_BACKUP_ATTRIBUTE,JSON.stringify(r)))},t.prototype._onTweenComplete=function(){return this._debug===!0&&console.log("[Transformer] - _onTweenComplete - @_transformsCount: "+this._transformsCount),0===--this._transformsCount?this.on.complete.send(this):void 0},t}(),console.log("%cAvalonA 1.1.2","font-size:80%;padding:0.2em 0.5em;color:#FFFFD5;background-color:#FF0066;"),n=function(i){var r;return r=function(){function r(t,e,i){if(this.frameId=t,this.layerId=e,null==i&&(i={}),this.stopRotation=h(this.stopRotation,this),this.mousemove=h(this.mousemove,this),this.mouseout=h(this.mouseout,this),!this.frameId)throw new Error("frameId argument cannot be null");if(!this.layerId)throw new Error("layerId argument cannot be null");this.debug=i.debug,n(),this.debug===!0&&console.log("transformStyleIsSupported: "+a),a?this.init(i):this.flatten=this.disableRotationEvent=this.disable=this.start=this.enable=this.refresh=this.applyTransformOn=this.refreshChildTransform=this.refreshTransform=this.untrackMouseMovements=this.trackMouseMovements=this.addPerspective=this.removePerspective=function(){}}var n,s,a;return s=function(t){return t},a=void 0,n=function(){var t;return void 0===a&&(t=document.createElement("b"),t.id="avalona-detection-element",t.style.position="absolute",t.style.top=0,t.style.left=0,document.body.appendChild(t),t.style.webkitTransformStyle="preserve-3d",t.style.MozTransformStyle="preserve-3d",t.style.msTransformStyle="preserve-3d",t.style.transformStyle="preserve-3d",a="preserve-3d"===e.getTransformStyle(getComputedStyle(t)),document.body.removeChild(t)),a},r.prototype.find3dFrames=function(){if(this.frame=document.getElementById(this.frameId),this.transformedLayer=this.frame.querySelector("#"+this.layerId),this.debug===!0&&(console.log("@transformAttribute: "+this.transformAttribute),console.log("@layerId: "+this.layerId)),!this.frame)throw new Error("Cannot find 3d frame '#"+this.frameId+"' in dom");if(!this.transformedLayer)throw new Error("Cannot find 3d inner frame '#"+this.frameId+" > #"+this.layerId+"' in dom")},r.prototype.addPerspective=function(){return i.set(this.transformedLayer,{css:{perspective:1e3}})},r.prototype.removePerspective=function(){return i.set(this.transformedLayer,{css:{perspective:"none"}})},r.prototype.trackMouseMovements=function(){var t,e,i,r,o;if(this.debug===!0&&this.activeArea){e="avalona-active-area",t=document.getElementById(e)||document.createElement("div"),t.textContent="AvalonA Active Area",t.id=e,i={"background-color":"hotpink",opacity:.5,"pointer-events":"none",position:"absolute",visibility:"hidden","z-index":1e4};for(r in i)o=i[r],t.style.setProperty(r,o);document.body.appendChild(t),this.debugMouseMove=function(){var e,i,n;console.log("rotationX: "+this.rotationX+", rotationY: "+this.rotationY),e=this.activeArea.bounds(),i={visibility:"visible",left:e.xMin+"px",top:e.yMin+"px",width:e.xMax-e.xMin+"px",height:e.yMax-e.yMin+"px"},n=[];for(r in i)o=i[r],n.push(t.style.setProperty(r,o));return n}}else this.debugMouseMove=function(){};return this.activeArea?this.activeArea.init(this.frame):this.frame.addEventListener("mouseleave",function(t){return t.target.id===this.frameId?this.mouseout():void 0},!1),this.frame.addEventListener("mousemove",this.mousemove,!1)},r.prototype.mouseout=function(){return this.disableRotation()},r.prototype.mouseMoveCount=0,r.prototype.mousemove=function(t){return++this.mouseMoveCount%5>0?void 0:!this.activeArea||this.activeArea.mouseover(t)?(this.onrotation(),this.rotationY=(t.pageX-window.innerWidth/2)/25,this.rotationX=-1*(t.pageY-window.innerHeight/2)/15,this.debugMouseMove(),i.to(this.transformedLayer,.1,{css:{rotationX:this.fy(this.rotationX),rotationY:this.fx(this.rotationY)}})):this.disableRotation()},r.prototype.onrotation=function(){var t;return clearTimeout(this.rotationTimeoutId),this.rotating||(null!=(t=this.animation)&&t.pause(),"function"==typeof this.onstartrotation&&this.onstartrotation(),this.rotating=!0),this.idleTimeout>0?this.rotationTimeoutId=setTimeout(this.stopRotation,this.idleTimeout):void 0},r.prototype.stopRotation=function(){var t;return clearTimeout(this.rotationTimeoutId),this.rotating?(this.rotating=!1,"function"==typeof this.onendrotation&&this.onendrotation(),null!=(t=this.animation)?t.play():void 0):void 0},r.prototype.disableRotation=function(t){return null==t&&(t=1),(this.rotationX||this.rotationY)&&null==this.animation&&this.resetRotation(t),this.stopRotation()},r.prototype.resetRotation=function(t){return null==t&&(t=1),clearTimeout(this.rotationTimeoutId),this.rotationX=this.rotationY=0,i.to(this.transformedLayer,t,{css:{rotationX:0,rotationY:0}})},r.prototype.resetTransform=function(){var t,e,i,r;clearTimeout(this.rotationTimeoutId),this.rotationX=this.rotationY=0,t={"-webkit-transform":"none","-moz-transform":"none","-o-transform":"none","-ms-transform":"none",transform:"none"},e=[];for(i in t)r=t[i],e.push(this.transformedLayer.style.setProperty(i,r));return e},r.prototype.untrackMouseMovements=function(){var t,e;return null!=(t=this.frame)&&t.removeEventListener("mousemove",this.mousemove),null!=(e=this.frame)?e.removeEventListener("mouseleave",this.mouseout):void 0},r.prototype.refreshTransform=function(t){var i,r,n,s;if(this.disabled!==!0)return"string"==typeof t&&(t=t.trim()),i=!t||t===this.transformedLayer,null==t&&(t=this.transformedLayer),n="string"==typeof t?this.transformedLayer.querySelector(t):t,this.debug===!0&&console.log("rootNode: "+e.getDebugName(n)),s=new o({from:n,isRoot:i,transformAttribute:this.transformAttribute,debug:this.debug}),s.on.complete.register(function(t){return function(){return"function"==typeof t.onrefresh?t.onrefresh():void 0}}(this)),r=s.applyTransform(),i&&(this.layers=r),r},r.prototype.refresh=function(){var t,e,i,r;if(this.disabled=!1,!this.ready){try{"function"==typeof this.onready&&this.onready()}catch(o){t=o,console.error("AvalonA - refresh - Error occured on ready",t)}this.ready=!0}return this.frame&&(this.untrackMouseMovements(),null!=(i=this.animation)&&i.pause()),this.find3dFrames(),this.addPerspective(),e=this.refreshTransform(),this.trackMouseMovements(),null!=(r=this.animation)&&r.play(this.transformedLayer,this.transformAttribute),e},r.prototype.start=function(){return this.refresh()},r.prototype.enable=function(){return this.refresh()},r.prototype.disable=function(){var t;return this.frame&&(this.untrackMouseMovements(),this.disableRotationEvent(),null!=(t=this.animation)&&t.pause(),this.flatten(),this.removePerspective()),this.disabled=!0},r.prototype.disableRotationEvent=function(){return clearTimeout(this.rotationTimeoutId),this.rotating=!1,"function"==typeof this.onendrotation?this.onendrotation():void 0},r.prototype.flatten=function(){var t,r,n,s,a,h;for(this.resetTransform(),a=this.transformedLayer.querySelectorAll("["+o.CSS_BACKUP_ATTRIBUTE+"]"),h=[],r=0,n=a.length;n>r;r++)s=a[r],this.debug===!0&&console.log("flattening layer '"+e.getDebugName(s)+"'"),t=JSON.parse(s.getAttribute(o.CSS_BACKUP_ATTRIBUTE)),h.push(i.set(s,{css:t}));return h},r.prototype.init=function(e){var i,r,o,n;return this.transformAttribute=e.tAttr||"data-avalonA-transform",this.fx="function"==typeof e.fx?e.fx:s,this.fy="function"==typeof e.fy?e.fy:s,e.activeArea&&(this.activeArea=new t(e.activeArea)),null!=(i=this.activeArea)&&(i.debug=this.debug),this.onstartrotation=null!=(r=e.on)?r.startrotation:void 0,this.onendrotation=null!=(o=e.on)?o.endrotation:void 0,this.onready=null!=(n=e.on)?n.ready:void 0,this.onrefresh=e.on&&(e.on.refresh||e.on.enable||e.on.start),this.animation=e.animation,this.idleTimeout=parseInt(e.idleTimeout||1e3,10),this.animation&&this.assertAnimatorValid(),Object.defineProperties(this,{onenable:{get:function(){return this.onrefresh},set:function(t){return this.onrefresh=t}},onstart:{get:function(){return this.onrefresh},set:function(t){return this.onrefresh=t}}})},r.prototype.assertAnimatorValid=function(){if(!this.animation.play||"function"!=typeof this.animation.play)throw new Error("animation.play must be a function");if(!this.animation.pause||"function"!=typeof this.animation.pause)throw new Error("animation.pause must be a function")},r}(),function(t,e,i){return new r(t,e,i)}},"function"==typeof define&&define.amd?define("AvalonA",["tweenlite"],function(t){return n(t)}):window.AvalonA=n((null!=(s=window.GreenSockGlobals)?s.TweenLite:void 0)||TweenLite)}).call(this);