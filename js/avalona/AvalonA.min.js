!function(){var t,e,i=function(t,e){return function(){return t.apply(e,arguments)}};console.log("%cAvalonA 0.10.2","font-size:80%;padding:0.2em 0.5em;color:#FFFFD5;background-color:#FF0066;"),t=function(t){var e,o;return e=function(){function t(t){var e,i;if(this.area=t,!this.area)throw new Error("area argument is missing");this.position=this.area.position||"auto","object"==typeof this.position&&(null==(e=this.position).x&&(e.x="auto"),null==(i=this.position).y&&(i.y="auto"),"auto"===this.position.x&&"auto"===this.position.y&&(this.position="auto")),this.attachment=this.area.attachment||"fixed",this.assertValid(),this.processActiveArea()}var e,i;return e=/^\d+(%|px)?$/gi,i=function(t){var i;return e.lastIndex=0,i=e.test(t),e.lastIndex=0,i},t.prototype.assertValid=function(){var t,e;if(t=["The following validation errors occured:"],"object"!=typeof this.position?"auto"!==this.position&&t.push("area.position is not valid ("+this.position+")"):("auto"===this.position.x||i(this.position.x)||t.push("area.position.x is not valid ("+this.position.x+"})"),"auto"===this.position.y||i(this.position.y)||t.push("area.position.y is not valid ("+this.position.y+"})")),"fixed"!==(e=this.attachment)&&"scroll"!==e&&t.push("area.attachment is not valid ("+this.attachment+")"),i(this.area.width)||t.push("area.width is not valid ("+this.area.width+")"),i(this.area.height)||t.push("area.height is not valid ("+this.area.height+")"),t.length>1)throw new Error(t.join("\n"))},t.prototype.processActiveArea=function(){return this.width=parseInt(this.area.width,10),this.widthIsFluid="%"===e.exec(this.area.width)[1],e.lastIndex=0,this.height=parseInt(this.area.height,10),this.heightIsFluid="%"===e.exec(this.area.height)[1],e.lastIndex=0,"object"==typeof this.position&&("auto"!==this.position.x&&(this.x=parseInt(this.position.x,10)),"auto"!==this.position.y)?this.y=parseInt(this.position.y,10):void 0},t.prototype.init=function(t){var e,i,o,n,r,s,a,h=this;if(this.frame=t,!this.frame)throw new Error("frame argument cannot be null");return this.xBase=(s=this.getXBaseComputation())(),this.yBase=(a=this.getYBaseComputation())(),this.xMaxComputation=this.widthIsFluid?function(){return this.xMin+this.width/100*parseInt(getComputedStyle(this.frame).width,10)}:function(){return this.xMin+this.width},this.yMaxComputation=this.heightIsFluid?function(){return this.yMin+this.height/100*parseInt(getComputedStyle(this.frame).height,10)}:function(){return this.yMin+this.height},"fixed"===this.attachment?(this.xPadding=this.frame.scrollLeft,this.yPadding=this.frame.scrollTop,this.debug===!0?(console.log("Listen to scroll event"),n=this,o=function(){return console.log("Scroll : @xPadding = "+n.xPadding+", @yPadding = "+n.yPadding)}):o=function(){},r=0,window.addEventListener("scroll",function(){return++r%5>0?void 0:(h.xPadding=window.pageXOffset,h.yPadding=window.pageYOffset,h.refreshBounds(),o())},!1),e=0,this.frame.addEventListener("scroll",function(){return++e%5>0?void 0:(h.xPadding=h.frame.scrollLeft,h.yPadding=h.frame.scrollTop,h.refreshBounds(),o())},!1)):this.xPadding=this.yPadding=0,this.debug===!0?(n=this,i=function(){return console.log("Resize : @frame.style.width = "+getComputedStyle(n.frame).width+", @frame.style.height = "+getComputedStyle(n.frame).height)}):i=function(){},window.addEventListener("resize",function(){return h.xBase=s(),h.yBase=a(),h.refreshBounds(),i()},!1),this.refreshBounds()},t.prototype.refreshBounds=function(){return this.xMin=this.xBase+this.xPadding,this.xMax=this.xMaxComputation(),this.yMin=this.yBase+this.yPadding,this.yMax=this.yMaxComputation()},t.prototype.bounds=function(){return{xMin:this.xMin,xMax:this.xMax,yMin:this.yMin,yMax:this.yMax}},t.prototype.getXBaseComputation=function(){var t,i,o=this;return t=parseInt(getComputedStyle(this.frame).width,10),this.position.x&&"auto"!==this.position.x?(i="%"===e.exec(this.position.x)[1]?function(){return o.x/100*t}:function(){return o.x},e.lastIndex=0):i=this.widthIsFluid?function(){return(50-o.width/2)/100*t}:function(){return t/2-o.width/2},i},t.prototype.getYBaseComputation=function(){var t,i,o=this;return t=parseInt(getComputedStyle(this.frame).height,10),this.position.y&&"auto"!==this.position.y?(i="%"===e.exec(this.position.y)[1]?function(){return o.y/100*t}:function(){return o.y},e.lastIndex=0):i=this.heightIsFluid?function(){return(50-o.height/2)/100*t}:function(){return t/2-o.height/2},i},t.prototype.mouseover=function(t){var e,i;return this.xMin<=(e=t.pageX)&&e<=this.xMax&&this.yMin<=(i=t.pageY)&&i<=this.yMax},t}(),o=function(){function o(t,e,o){if(this.frameId=t,this.layerId=e,null==o&&(o={}),this.refreshChildTransform=i(this.refreshChildTransform,this),this.stopRotation=i(this.stopRotation,this),this.mousemove=i(this.mousemove,this),this.mouseout=i(this.mouseout,this),!this.frameId)throw new Error("frameId argument cannot be null");if(!this.layerId)throw new Error("layerId argument cannot be null");this.debug=o.debug,s(),this.debug===!0&&console.log("transformStyleIsSupported: "+u),u?this.init(o):this.flatten=this.disableRotationEvent=this.disable=this.start=this.enable=this.refresh=this.applyTransformOn=this.refreshChildTransform=this.refreshTransform=this.untrackMouseMovements=this.trackMouseMovements=this.addPerspective=this.removePerspective=function(){}}var n,r,s,a,h,u,l;return l=.75,h=function(t){return t},u=void 0,n="data-css-backup",s=function(){var t;return void 0===u&&(t=document.createElement("b"),t.id="avalona-detection-element",t.style.position="absolute",t.style.top=0,t.style.left=0,document.body.appendChild(t),t.style.webkitTransformStyle="preserve-3d",t.style.MozTransformStyle="preserve-3d",t.style.msTransformStyle="preserve-3d",t.style.transformStyle="preserve-3d",u="preserve-3d"===a(t),document.body.removeChild(t)),u},a=function(t){var e;return e=getComputedStyle(t,null),e.getPropertyValue("-webkit-transform-style")||e.getPropertyValue("-moz-transform-style")||e.getPropertyValue("-ms-transform-style")||e.getPropertyValue("transform-style")},r=function(t){return""+t.tagName+"("+(t.id||t.getAttribute("class")||t.getAttribute("href"))+")"},o.prototype.find3dFrames=function(){if(this.frame=document.getElementById(this.frameId),this.transformedLayer=this.frame.querySelector("#"+this.layerId),this.debug===!0&&(console.log("@transformAttribute: "+this.transformAttribute),console.log("@layerId: "+this.layerId)),!this.frame)throw new Error("Cannot find 3d frame '#"+this.frameId+"' in dom");if(!this.transformedLayer)throw new Error("Cannot find 3d inner frame '#"+this.frameId+" > #"+this.layerId+"' in dom")},o.prototype.addPerspective=function(){return t.set(this.transformedLayer,{css:{perspective:1e3}})},o.prototype.removePerspective=function(){return t.set(this.transformedLayer,{css:{perspective:"none"}})},o.prototype.trackMouseMovements=function(){var t,e,i,o,n;if(this.debug===!0&&this.activeArea){e="avalona-active-area",t=document.getElementById(e)||document.createElement("div"),t.textContent="AvalonA Active Area",t.id=e,n={"background-color":"hotpink",opacity:.5,"pointer-events":"none",position:"absolute",visibility:"hidden","z-index":1e4};for(i in n)o=n[i],t.style.setProperty(i,o);document.body.appendChild(t),this.debugMouseMove=function(){var e,n,r;console.log("rotationX: "+this.rotationX+", rotationY: "+this.rotationY),e=this.activeArea.bounds(),n={visibility:"visible",left:""+e.xMin+"px",top:""+e.yMin+"px",width:""+(e.xMax-e.xMin)+"px",height:""+(e.yMax-e.yMin)+"px"},r=[];for(i in n)o=n[i],r.push(t.style.setProperty(i,o));return r}}else this.debugMouseMove=function(){};return this.activeArea?this.activeArea.init(this.frame):this.frame.addEventListener("mouseleave",function(t){return t.target.id===this.frameId?this.mouseout():void 0},!1),this.frame.addEventListener("mousemove",this.mousemove,!1)},o.prototype.mouseout=function(){return this.disableRotation()},o.prototype.mouseMoveCount=0,o.prototype.mousemove=function(e){return++this.mouseMoveCount%5>0?void 0:!this.activeArea||this.activeArea.mouseover(e)?(this.onrotation(),this.rotationY=(e.pageX-window.innerWidth/2)/25,this.rotationX=-1*(e.pageY-window.innerHeight/2)/15,this.debugMouseMove(),t.to(this.transformedLayer,.1,{css:{rotationX:this.fy(this.rotationX),rotationY:this.fx(this.rotationY)}})):this.disableRotation()},o.prototype.onrotation=function(){var t;return clearTimeout(this.rotationTimeoutId),this.rotating||(null!=(t=this.animation)&&t.pause(),"function"==typeof this.onstartrotation&&this.onstartrotation(),this.rotating=!0),this.idleTimeout>0?this.rotationTimeoutId=setTimeout(this.stopRotation,this.idleTimeout):void 0},o.prototype.stopRotation=function(){var t;return clearTimeout(this.rotationTimeoutId),this.rotating?(this.rotating=!1,"function"==typeof this.onendrotation&&this.onendrotation(),null!=(t=this.animation)?t.play():void 0):void 0},o.prototype.disableRotation=function(t){return null==t&&(t=1),(this.rotationX||this.rotationY)&&null==this.animation&&this.resetRotation(t),this.stopRotation()},o.prototype.resetRotation=function(e){return null==e&&(e=1),clearTimeout(this.rotationTimeoutId),this.rotationX=this.rotationY=0,t.to(this.transformedLayer,e,{css:{rotationX:0,rotationY:0}})},o.prototype.resetTransform=function(){var t,e,i,o;clearTimeout(this.rotationTimeoutId),this.rotationX=this.rotationY=0,i={"-webkit-transform":"none","-moz-transform":"none","-o-transform":"none","-ms-transform":"none",transform:"none"},o=[];for(t in i)e=i[t],o.push(this.transformedLayer.style.setProperty(t,e));return o},o.prototype.untrackMouseMovements=function(){var t,e;return null!=(t=this.frame)&&t.removeEventListener("mousemove",this.mousemove),null!=(e=this.frame)?e.removeEventListener("mouseleave",this.mouseout):void 0},o.prototype.refreshTransform=function(t){var e,i,o,n,s,a;if(null==t&&(t=null),this.disabled!==!0){for(null==t&&(t=this.transformedLayer),i="string"==typeof t?this.transformedLayer.querySelector(t):t,this.debug===!0&&console.log("target: "+r(i)),this.applyTransformOn(i),this.debug===!0&&console.log("refreshTransform firstChild: "+r(i.firstElementChild)),s=i.children,a=[],o=0,n=s.length;n>o;o++)e=s[o],a.push(this.refreshChildTransform(e));return a}},o.prototype.refreshChildTransform=function(t){if(!t)throw new Error("refreshChildTransform child argument cannot be null");return t.querySelectorAll("["+this.transformAttribute+"]").length?(this.debug===!0&&console.log("refreshTransform child "+r(t)+" has children"),this.refreshTransform(t)):t.getAttribute(this.transformAttribute)&&(this.debug===!0&&console.log("refreshTransform child "+r(t)+" has '"+this.transformAttribute+"'"),this.applyTransformOn(t)),t},o.prototype.applyTransformOn=function(e){var i,o,r,s,h,u,f,d,p,m,c,y,v,g,x,b,w;if(!e)throw new Error("applyTransformOn target argument cannot be null");if(e.getAttribute(n)||(p=getComputedStyle(e),o={transformStyle:a(e)||"flat",overflow:p.overflow||"inherit"},m=p.getPropertyValue("-webkit-transform")||p.getPropertyValue("-moz-transform")||p.getPropertyValue("-o-transform")||p.getPropertyValue("-ms-transform")||p.getPropertyValue("transform"),m&&(o.transform=m),e.setAttribute(n,JSON.stringify(o))),t.set(e,{css:{transformStyle:"preserve-3d",overflow:"visible"}}),i=e.getAttribute(this.transformAttribute)){for(c={},b=i.split(";"),g=0,x=b.length;x>g;g++)d=b[g],w=d.split(":"),s=w[0],y=w[1],c[s.trim()]=parseInt(y.trim(),10);if(v=c.z,h=c.rx,u=c.ry,f=c.rz,v||h||u||f)return r={},v&&(r.z=v),h&&(r.rotationX=h),u&&(r.rotationY=u),f&&(r.rotationZ=f),t.to(e,l,{css:r})}},o.prototype.refresh=function(){var t,e;return this.disabled=!1,this.frame&&(this.untrackMouseMovements(),null!=(t=this.animation)&&t.pause()),this.find3dFrames(),this.addPerspective(),this.refreshTransform(),this.trackMouseMovements(),null!=(e=this.animation)?e.play(this.transformedLayer,this.transformAttribute):void 0},o.prototype.start=function(){return this.refresh()},o.prototype.enable=function(){return this.refresh()},o.prototype.disable=function(){var t;return this.frame&&(this.untrackMouseMovements(),this.disableRotationEvent(),null!=(t=this.animation)&&t.pause(),this.flatten(),this.removePerspective()),this.disabled=!0},o.prototype.disableRotationEvent=function(){return clearTimeout(this.rotationTimeoutId),this.rotating=!1,"function"==typeof this.onendrotation?this.onendrotation():void 0},o.prototype.flatten=function(){var e,i,o,s,a,h;for(this.resetTransform(),a=this.transformedLayer.querySelectorAll("["+n+"]"),h=[],o=0,s=a.length;s>o;o++)i=a[o],this.debug===!0&&console.log("flattening layer '"+r(i)+"'"),e=JSON.parse(i.getAttribute(n)),h.push(t.set(i,{css:e}));return h},o.prototype.init=function(t){var i,o,n;return this.transformAttribute=t.tAttr||"data-avalonA-transform",this.fx="function"==typeof t.fx?t.fx:h,this.fy="function"==typeof t.fy?t.fy:h,t.activeArea&&(this.activeArea=new e(t.activeArea)),null!=(i=this.activeArea)&&(i.debug=this.debug),this.onstartrotation=null!=(o=t.on)?o.startrotation:void 0,this.onendrotation=null!=(n=t.on)?n.endrotation:void 0,this.animation=t.animation,this.idleTimeout=parseInt(t.idleTimeout||1e3,10),this.animation?this.assertAnimatorValid():void 0},o.prototype.assertAnimatorValid=function(){if(!this.animation.play||"function"!=typeof this.animation.play)throw new Error("animation.play must be a function");if(!this.animation.pause||"function"!=typeof this.animation.pause)throw new Error("animation.pause must be a function")},o}(),function(t,e,i){return null==i&&(i=!1),new o(t,e,i)}},"function"==typeof define&&define.amd?define("AvalonA",["tweenlite"],function(e){return t(e)}):window.AvalonA=t((null!=(e=window.GreenSockGlobals)?e.TweenLite:void 0)||TweenLite)}.call(this);
;